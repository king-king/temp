<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <title>flower</title>
    <style>
        html, body {
            overflow: hidden;
            height: 100%;
            margin: 0;
            perspective: 1500px;
        }

        .bg {
            height: 100%;
            position: absolute;
        }

        img {
            position: absolute;
        }
    </style>
</head>
<body>
<img src="../img/1.jpg" class="bg">
<script src="tool.js"></script>
<script>
    (function () {
        var body = document.body ,
                h = body.offsetHeight ,
                w = body.offsetWidth ,
                flowerT = [] ,
                flowers = [];

        loop( 6 , function ( i ) {
            var img = new Image();
            img.src = "img/flower/" + i + ".png";
            flowerT.push( img );
        } );

        function initImage( img ) {
            img.wvx = w / 250 * (Math.random() - 0.5);
            img.wvy = h / 250 * (Math.random() * 0.5 + 0.5);
            img.wvz = (img.wvx + img.wvy) * (Math.random() + 0.5) * 2;
            img.size = w / 20 * (Math.random() * 0.5 + 0.5);
            img.wx = Math.random() * w;
            img.wz = 500 * Math.random() + 500;
            img.wr = 90 * Math.random() << 0;
            img.wy = 0;
        }

        // 生成
        var goOn = true;
        var gindex = 0;
        setTimeout( function () {
            loop( 8 , function () {
                var img = flowerT[ gindex ].cloneNode();
                gindex = (gindex + 1) % 6;
                body.appendChild( img );
                initImage( img );
                css( img , {
                    width : img.size + "px" ,
                    transform : "translate3d(" + img.wx + "px," + img.wy + "px," + img.wz + "px) rotate3d(1," + img.wvx / img.wvy + ",0," + (++img.wr) +
                    "deg)"
                } );
                flowers.push( img );
            } );
            if ( goOn ) {
                setTimeout( arguments.callee , 1000 );
            } else {
                console.log( flowers.length )
            }
        } , 400 );

        // draw
        setTimeout( function () {
            loopArray( flowers , function ( f ) {
                f.wx += f.wvx;
                f.wy += f.wvy;
                f.wz += f.wvz;
                if ( f.wy > h + f.size ) {
                    initImage( f );
                    goOn = false;
                }
                if ( f.wx < 0 || f.wx > w || w.wz > 1500 ) {
                    initImage( f );
                }
                css( f , {
                    width : f.size + "px" ,
                    transform : "translate3d(" + f.wx + "px," + f.wy + "px," + f.wz + "px)"

//                    transform : "translate3d(" + f.wx + "px," + f.wy + "px," + f.wz + "px) rotate3d(1," + f.wvx / f.wvy + ",0," + (++f.wr) +
//                    "deg)"
                } );
            } );
            setTimeout( arguments.callee , 20 );
        } , 20 );


    })();
</script>
</body>
</html>