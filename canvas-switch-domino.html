<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="utf-8">
    <meta name="mobileoptimized" content="0"/>
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="screen-orientation" content="portrait">
    <meta name="browsermode" content="application">
    <title></title>
    <style>
        .page {
            position: absolute;
            top: 0;
            left: 0;
            height: 400px;
            width: 400px;
            overflow: hidden;
        }

        img {
            height: 100%;
        }

        canvas {
            -webkit-transform: rotateX(90deg);
            position: absolute;
            -webkit-transform-origin: 50% 0;
            -webkit-perspective: 400px;
        }

        @-webkit-keyframes rotateFromLeft {

        }
    </style>
</head>
<body>

<div class="page"><img src="img/2.jpg"></div>


<script src="zMobile.js"></script>
<script>
    (function () {

        var page = document.querySelector( ".page" );
        var img = document.createElement( "img" );

        var canvas = document.createElement( "canvas" );
        var ctx = canvas.getContext( "2d" );

        img.src = "img/1.jpg";

        function fregment( img, x, y, w, h ) {
            var canvas = document.createElement( "canvas" );
            canvas.width = w;
            canvas.height = h;
            canvas.style.width = w + "px";
            canvas.style.height = h + "px";
            var ctx = canvas.getContext( "2d" );
            ctx.drawImage( img, x, y, w, h, 0, 0, w, h );
            return canvas;
        }

        var count = 10;

        var w = page.offsetWidth / count;
        var h = page.offsetHeight / count;
        img.onload = function () {
            Z.loop( 2 * count - 1, function ( y ) {
                var klass = "canvas" + y;
                canvas.classList.add( klass );
                var css = {};
                css["canvas.animate." + klass] = {
                    "-webkit-transform" : "rotateX(0deg)",
                    "-webkit-transition" : "0.2s cubic-bezier(.17,.67,.63,1.59)" + y * 0.1 + "s"
                };
                Z.insertCSSRules( css );
                Z.loop( y + 1, function ( n ) {
                    if ( 0 + n < count && y - n < count ) {
                        var canvas = fregment( img, (0 + n) * w, (y - n) * h, w, h );
                        canvas.classList.add( klass );
                        page.appendChild( canvas );
                        Z.css( canvas, {
                            left : (0 + n) * w + "px",
                            top : (y - n) * h + "px"
                        } );
                        setTimeout( function () {
                            canvas.classList.add( "animate" );
                        }, 0 );
                    }
                } );
            } )

        }


    })();
</script>
</body>
</html>