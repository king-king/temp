<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="mobileoptimized" content="0"/>
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="screen-orientation" content="portrait">
    <meta name="browsermode" content="application">
    <title></title>
    <style>
        body,html{position:absolute;top:0;left:0;right:0;bottom:0;margin:0;padding:0;background:#f0eff7;font-family:"微软雅黑",sans-serif;overflow:hidden}.content{position:absolute;top:7px;left:7px;right:7px;bottom:0;background-color:#fff;border-radius:3px;box-shadow:0 0 4px #ccc;overflow-x:hidden;overflow-y:scroll;-webkit-overflow-scrolling:touch}.top-3{height:193px;border-bottom:1px solid #dcdcdc;box-sizing:border-box;margin:0 1px;font-size:0;position:relative}.no-1,.no-2,.no-3{display:inline-block;height:100%;box-sizing:border-box;position:absolute;top:0;left:0}.hide{visibility:hidden!important}.img-wrapper{height:100px;position:relative}.star-1,.star-2,.star-3{position:absolute;bottom:0;right:0}.star-1{height:20px}.star-2{height:19px}.star-3{height:18px}.head-photo-1{width:84px;height:84px;border-radius:84px;border:2px solid #FF5300;box-sizing:border-box;position:absolute;bottom:0;left:50%;margin-left:-42px}.head-photo-2{width:68px;height:68px;border-radius:68px;border:2px solid #FF8F00;box-sizing:border-box;position:absolute;bottom:0;left:50%;margin-left:-34px}.head-photo-3{width:60px;height:60px;border-radius:60px;border:2px solid #FFBF00;box-sizing:border-box;position:absolute;bottom:0;left:50%;margin-left:-30px}.top-3 .name{color:#FF4B77;font-size:9px;white-space:nowrap;text-overflow:ellipsis;line-height:13px;height:13px;margin-top:5px;padding:0 11px;text-align:center;overflow:hidden}.top-3 .introduction{word-break:break-all;display:inline-block;color:#1c3041;font-size:10px;line-height:14px;padding:0 11px;margin-top:9px;width:100%;box-sizing:border-box}.top-3 .heat-degree{font-size:17px;text-align:center;height:22px;line-height:22px;color:#FD2353;position:absolute;bottom:11px;left:11px;right:11px}.item{height:50px;box-sizing:border-box;border-bottom:1px solid #dcdcdc;margin:0 1px;position:relative}.number{height:15px;line-height:15px;text-align:right;color:#ADADAD;font-size:12px;width:24px;position:absolute;top:19px;left:0}.head-photo{width:26px;height:26px;border-radius:26px;position:absolute;top:12px;left:33px}.user-name{height:11px;line-height:11px;font-size:10px;color:#FF4B77;position:absolute;left:65px;top:12px;right:77px}.user-introduction{line-height:14px;color:#1c3041;font-size:10px;position:absolute;left:65px;top:24px;right:77px}.fire{height:15px;position:absolute;top:15px;right:50px}.user-heat{position:absolute;width:47px;top:16px;right:0;height:15px;line-height:15px;font-size:12px;color:#989898}.user-heat span{font-size:8px;position:relative;top:-1px;left:1px}
    </style>
</head>
<body>
<div class="content">
    <div class="top-3">
        <div class="no-2 hide ">
            <div class="img-wrapper">
                <div class="head-photo-2 top3-head-photo"><img class="star-2"></div>
            </div>
            <div class="name"></div>
            <div class="introduction"></div>
            <div class="heat-degree"></div>
        </div>
        <div class="no-1 hide ">
            <div class="img-wrapper">
                <div class="head-photo-1 top3-head-photo"><img class="star-1"></div>
            </div>
            <div class="name"></div>
            <div class="introduction"></div>
            <div class="heat-degree"></div>

        </div>
        <div class="no-3  hide">
            <div class="img-wrapper">
                <div class="head-photo-3 top3-head-photo"><img class="star-3"></div>
            </div>
            <div class="name"></div>
            <div class="introduction"></div>
            <div class="heat-degree"></div>

        </div>
    </div>
</div>
<script>
    // todo 将数据换成真实际的即可
    var data = [
        {
            "HeatDegree": 12345,
            "User": {
                "id": 232342,
                "nickname": "嗒也",
                "introduction": "芒种-孩子们梦开始的季节芒种-孩子们梦开始的季节。芒种-孩子们梦开始的季节",
                "headPhoto": "http://wx.qlogo.cn/mmopen/FV9nic9Akne8x3HhSpVwOptLVunxUqwz3MzlWCGz0zk081hZmYqSXVicrOF6Dcw6atMCbJV8UKicraMjTZzicp6YVcvxLtqwM5md/132",
                "sex": 1
            },
            "WorkId": 12321323,
            "Url": "http://www.ichue.cn/12321323",
            "skip": 12
        },
        {
            "HeatDegree": 12132,
            "User": {
                "id": 232342,
                "nickname": "维勒",
                "introduction": "ddfsdfsdf",
                "headPhoto": "http://wx.qlogo.cn/mmopen/FV9nic9Akne8x3HhSpVwOptLVunxUqwz3MzlWCGz0zk081hZmYqSXVicrOF6Dcw6atMCbJV8UKicraMjTZzicp6YVcvxLtqwM5md/132",
                "sex": 1
            },
            "WorkId": 12321323,
            "Url": "http://www.ichue.cn/12321323",
            "skip": 12
        },
        {
            "HeatDegree": 12132,
            "User": {
                "id": 232342,
                "nickname": "李德海",
                "introduction": "ddfsdfsdf",
                "headPhoto": "http://wx.qlogo.cn/mmopen/FV9nic9Akne8x3HhSpVwOptLVunxUqwz3MzlWCGz0zk081hZmYqSXVicrOF6Dcw6atMCbJV8UKicraMjTZzicp6YVcvxLtqwM5md/132",
                "sex": 1
            },
            "WorkId": 12321323,
            "Url": "http://www.ichue.cn/12321323",
            "skip": 12
        },
        {
            "HeatDegree": 123,
            "User": {
                "id": 232342,
                "nickname": "李大海",
                "introduction": "ddfsdfsdf",
                "headPhoto": "http://wx.qlogo.cn/mmopen/FV9nic9Akne8x3HhSpVwOptLVunxUqwz3MzlWCGz0zk081hZmYqSXVicrOF6Dcw6atMCbJV8UKicraMjTZzicp6YVcvxLtqwM5md/132",
                "sex": 1
            },
            "WorkId": 12321323,
            "Url": "http://www.ichue.cn/12321323",
            "skip": 12
        },
        {
            "HeatDegree": 12132,
            "User": {
                "id": 232342,
                "nickname": "六嗨",
                "introduction": "芒种-孩子们梦开始的季节芒种-孩子们梦开始的季节。芒种-孩子们梦开始的季节",
                "headPhoto": "http://wx.qlogo.cn/mmopen/FV9nic9Akne8x3HhSpVwOptLVunxUqwz3MzlWCGz0zk081hZmYqSXVicrOF6Dcw6atMCbJV8UKicraMjTZzicp6YVcvxLtqwM5md/132",
                "sex": 1
            },
            "WorkId": 12321323,
            "Url": "http://www.ichue.cn/12321323",
            "skip": 12
        },
        {
            "HeatDegree": 12132,
            "User": {
                "id": 232342,
                "nickname": "啥事",
                "introduction": "ddfsdfsdf",
                "headPhoto": "http://wx.qlogo.cn/mmopen/FV9nic9Akne8x3HhSpVwOptLVunxUqwz3MzlWCGz0zk081hZmYqSXVicrOF6Dcw6atMCbJV8UKicraMjTZzicp6YVcvxLtqwM5md/132",
                "sex": 1
            },
            "WorkId": 12321323,
            "Url": "http://www.ichue.cn/12321323",
            "skip": 12
        },
        {
            "HeatDegree": 12132,
            "User": {
                "id": 232342,
                "nickname": "李奇巧",
                "introduction": "ddfsdfsdf",
                "headPhoto": "http://wx.qlogo.cn/mmopen/FV9nic9Akne8x3HhSpVwOptLVunxUqwz3MzlWCGz0zk081hZmYqSXVicrOF6Dcw6atMCbJV8UKicraMjTZzicp6YVcvxLtqwM5md/132",
                "sex": 1
            },
            "WorkId": 12321323,
            "Url": "http://www.ichue.cn/12321323",
            "skip": 12
        },
        {
            "HeatDegree": 12132,
            "User": {
                "id": 232342,
                "nickname": "照壮",
                "introduction": "ddfsdfsdf",
                "headPhoto": "http://wx.qlogo.cn/mmopen/FV9nic9Akne8x3HhSpVwOptLVunxUqwz3MzlWCGz0zk081hZmYqSXVicrOF6Dcw6atMCbJV8UKicraMjTZzicp6YVcvxLtqwM5md/132",
                "sex": 1
            },
            "WorkId": 12321323,
            "Url": "http://www.ichue.cn/12321323",
            "skip": 12
        },
        {
            "HeatDegree": 12132,
            "User": {
                "id": 232342,
                "nickname": "离护栏",
                "introduction": "ddfsdfsdf",
                "headPhoto": "http://wx.qlogo.cn/mmopen/FV9nic9Akne8x3HhSpVwOptLVunxUqwz3MzlWCGz0zk081hZmYqSXVicrOF6Dcw6atMCbJV8UKicraMjTZzicp6YVcvxLtqwM5md/132",
                "sex": 1
            },
            "WorkId": 12321323,
            "Url": "http://www.ichue.cn/12321323",
            "skip": 12
        },
        {
            "HeatDegree": 12132,
            "User": {
                "id": 232342,
                "nickname": "宝马",
                "introduction": "ddfsdfsdf",
                "headPhoto": "http://wx.qlogo.cn/mmopen/FV9nic9Akne8x3HhSpVwOptLVunxUqwz3MzlWCGz0zk081hZmYqSXVicrOF6Dcw6atMCbJV8UKicraMjTZzicp6YVcvxLtqwM5md/132",
                "sex": 1
            },
            "WorkId": 12321323,
            "Url": "http://www.ichue.cn/12321323",
            "skip": 12
        },
        {
            "HeatDegree": 12132,
            "User": {
                "id": 232342,
                "nickname": "坐奔驰",
                "introduction": "ddfsdfsdf",
                "headPhoto": "http://wx.qlogo.cn/mmopen/FV9nic9Akne8x3HhSpVwOptLVunxUqwz3MzlWCGz0zk081hZmYqSXVicrOF6Dcw6atMCbJV8UKicraMjTZzicp6YVcvxLtqwM5md/132",
                "sex": 1
            },
            "WorkId": 12321323,
            "Url": "http://www.ichue.cn/12321323",
            "skip": 12
        },
        {
            "HeatDegree": 12132,
            "User": {
                "id": 232342,
                "nickname": "拖拉机手",
                "introduction": "ddfsdfsdf",
                "headPhoto": "http://wx.qlogo.cn/mmopen/FV9nic9Akne8x3HhSpVwOptLVunxUqwz3MzlWCGz0zk081hZmYqSXVicrOF6Dcw6atMCbJV8UKicraMjTZzicp6YVcvxLtqwM5md/132",
                "sex": 1
            },
            "WorkId": 12321323,
            "Url": "http://www.ichue.cn/12321323",
            "skip": 12
        },
        {
            "HeatDegree": 12132,
            "User": {
                "id": 232342,
                "nickname": "插秧手",
                "introduction": "ddfsdfsdf",
                "headPhoto": "http://wx.qlogo.cn/mmopen/FV9nic9Akne8x3HhSpVwOptLVunxUqwz3MzlWCGz0zk081hZmYqSXVicrOF6Dcw6atMCbJV8UKicraMjTZzicp6YVcvxLtqwM5md/132",
                "sex": 1
            },
            "WorkId": 12321323,
            "Url": "http://www.ichue.cn/12321323",
            "skip": 12
        },
        {
            "HeatDegree": 12132,
            "User": {
                "id": 232342,
                "nickname": "劳模",
                "introduction": "ddfsdfsdf",
                "headPhoto": "http://wx.qlogo.cn/mmopen/FV9nic9Akne8x3HhSpVwOptLVunxUqwz3MzlWCGz0zk081hZmYqSXVicrOF6Dcw6atMCbJV8UKicraMjTZzicp6YVcvxLtqwM5md/132",
                "sex": 1
            },
            "WorkId": 12321323,
            "Url": "http://www.ichue.cn/12321323",
            "skip": 12
        }
    ];
    var star1_src = "no-1-star.png";
    var star2_src = "no-2-star.png";
    var star3_src = "no-3-star.png";
    var fire_src = "fire.png";
    var getDataAPI = "";// 请求数据的api,和Skip拼出一个完整的api

</script>
<script>
    function css(el,style){for(var key in style){el.style.setProperty(key,style[key],null)}return el}function loopArray(arr,func){for(var i=0;i<arr.length;i++){func(arr[i],i)}}function $(tagName,arg,parent){var el=document.createElement(tagName);for(var key in arg){switch(key){case"classList":if(Object.prototype.toString.call(arg[key])=="[object String]"){el.classList.add(arg[key])}else{if(Object.prototype.toString.call(arg[key])=="[object Array]"){loopArray(arg[key],function(klass){el.classList.add(klass)})}}break;case"css":css(el,arg[key]);break;case"children":loopArray(arg[key],function(child){el.appendChild(child)});break;default:el[key]=arg[key]}}parent&&parent.appendChild(el);return el};
</script>
<script>
    var Skip;
    var max_length = 20;// 每次请求得到的数据条数,建议不少于20条
    var content = document.querySelector(".content");
    var no1 = document.querySelector(".no-1"),
            no2 = document.querySelector(".no-2"),
            no3 = document.querySelector(".no-3");
    var w = document.querySelector(".top-3").offsetWidth;
    no1.style.width = w / 612 * 224 + "px";
    no1.style.left = no3.style.width = w / 612 * (612 - 224) / 2 + "px";
    no2.style.width = no3.style.width = w / 612 * (612 - 224) / 2 + "px";
    no3.style.left = w / 612 * 224 + w / 612 * (612 - 224) / 2 + "px";

    function processIntroduction(el, text) {
        if (el.offsetHeight == 14) {
            el.style.textAlign = "center";
        } else {
            el.style.textAlign = "left";
            if (el.offsetHeight > 28) {
                for (var i = 1; i < text.length; i++) {
                    el.textContent = text.slice(0, i) + "…";
                    if (el.offsetHeight > 28) {
                        break;
                    }
                }
                el.textContent = text.slice(0, i - 1) + "…";
            }
        }
    }

    function processTop3(wrapper, data, star_src) {
        Skip = data.skip;
        wrapper.classList.remove("hide");
        var head = wrapper.querySelector(".top3-head-photo");
        head.querySelector("img").src = star_src;
        head.style.background = "url(" + data.User.headPhoto + ") center center";
        head.style.backgroundSize = "cover";
        head.style.backgroundSize = "cover";
        wrapper.querySelector(".name").textContent = data.User.nickname;
        wrapper.querySelector(".introduction").textContent = data.User.introduction;
        // 处理火爆值
        wrapper.querySelector(".heat-degree").textContent = data.HeatDegree < 10000 ? data.HeatDegree : ((data.HeatDegree / 10000).toFixed(1) + "万");
        processIntroduction(wrapper.querySelector(".introduction"), data.User.introduction);
    }

    data[0] && processTop3(no1, data[0], star1_src);
    data[1] && processTop3(no2, data[1], star2_src);
    data[2] && processTop3(no3, data[2], star3_src);

    var curNumber = 4;
    function processItem(d) {
        Skip = d.skip;
        var item = $("div", {
            classList: "item"
        }, content);
        $("img", {
            classList: "fire",
            src: fire_src
        }, item);
        $("div", {
            classList: "number",
            textContent: curNumber
        }, item);
        $("div", {
            classList: "head-photo",
            css: {
                background: "url(" + d.User.headPhoto + ") center center",
                "background-size": "cover"
            }
        }, item);
        $("div", {
            classList: "user-name",
            textContent: d.User.nickname
        }, item);
        var intro = $("div", {
            classList: "user-introduction",
            textContent: "[" + d.User.introduction + "]"
        }, item);
        if (intro.offsetHeight > 14) {
            for (var n = 1; n < d.User.introduction.length; n++) {
                intro.textContent = "[" + d.User.introduction.slice(0, n) + "... ]";
                if (intro.offsetHeight > 14) {
                    break;
                }
            }
            intro.textContent = "[" + d.User.introduction.slice(0, n - 1) + "... ]";
        }
        $("div", {
            classList: "user-heat",
            innerHTML: d.HeatDegree < 10000 ? d.HeatDegree : ((d.HeatDegree / 10000 ).toFixed(1) + "<span>万</span>")
        }, item);

        curNumber++;
    }

    if (data.length > 3) {
        loopArray(data.slice(3, data.length), function (d, i) {
            processItem(d);
        });
    }

    var isLoading = false;
    function ajax(onLoad) {
        var ax = new XMLHttpRequest();
        ax.open("GET", getDataAPI + Skip, true);
        ax.send();
        ax.onreadystatechange = function () {
            if (ax.readyState == 4) {
                var data = JSON.parse(ax.responseText);
                if (data.code == 200) {
                    loopArray(data.data, function (d) {
                        processItem(d);
                    });
                }
                onLoad();
            }
        };
    }

    if (data.length == max_length) {
        // 第一次请求到了足够的数据,才会有滑动加载
        content.onscroll = function () {
            if (!isLoading && content.scrollHeight - content.scrollTop - content.clientHeight < 70) {
                isLoading = true;
                ajax(function () {
                    isLoading = false;
                });
            }
        };
    }

</script>
</body>
</html>

