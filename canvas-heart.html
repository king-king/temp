<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <title></title>
    <style>
        canvas {
            transform: translate3d(-50%, 0, 0) scale(0.5);
            position: absolute;
            top: 20px;
            left: 50%;
        }

        body {
            /*background: url("img/flower.png");*/
            /*background-size: cover;*/
            overflow: hidden;
            margin: 0;
            height: 100%;
        }

        img {
            height: 100%;
            position: absolute;
            top: 0;
            left: 50%;
            transform: translate3d(-50%, 0, 0);
        }

        html {
            height: 100%;
        }
    </style>
</head>
<body>
<img src="img/love.jpg">
<canvas></canvas>
<script>
    (function () {
        var canvas = document.querySelector( "canvas" );
        var gl = canvas.getContext( "2d" );
        canvas.width = canvas.height = 500;

        var positions = [ [ 250 , 140 ] , [ 256.83099999999996 , 136.23727 ] , [ 263.524 , 132.74616 ] , [ 270.079 , 129.52228999999997 ] , [ 276.496 , 126.56128 ] , [ 282.775 , 123.85874999999999 ] , [ 288.9159999999999 , 121.41031999999997 ] , [ 294.919 , 119.21160999999998 ] , [ 300.78400000000005 , 117.25824000000001 ] , [ 306.511 , 115.54583000000001 ] , [ 312.1 , 114.07000000000002 ] , [ 317.551 , 112.82637 ] , [ 322.864 , 111.81055999999998 ] , [ 328.03899999999993 , 111.01818999999999 ] , [ 333.0759999999999 , 110.44487999999998 ] , [ 337.97499999999997 , 110.08624999999998 ] , [ 342.73599999999993 , 109.93792 ] , [ 347.35900000000004 , 109.99551 ] , [ 351.844 , 110.25464 ] , [ 356.191 , 110.71092999999999 ] , [ 360.4 , 111.36000000000001 ] , [ 364.47099999999995 , 112.19747 ] , [ 368.40399999999994 , 113.21896 ] , [ 372.19899999999996 , 114.42009000000002 ] , [ 375.856 , 115.79648 ] , [ 379.375 , 117.34375000000003 ] , [ 382.7560000000001 , 119.05752000000003 ] , [ 385.9990000000001 , 120.93341000000002 ] , [ 389.1040000000001 , 122.96704000000003 ] , [ 392.07100000000014 , 125.15403000000006 ] , [ 394.90000000000015 , 127.49000000000005 ] , [ 397.59100000000007 , 129.97057000000007 ] , [ 400.1440000000001 , 132.59136000000004 ] , [ 402.55900000000014 , 135.34799000000007 ] , [ 404.83600000000007 , 138.23608000000004 ] , [ 406.9750000000001 , 141.25125000000008 ] , [ 408.97600000000006 , 144.38912000000005 ] , [ 410.83900000000006 , 147.64531000000008 ] , [ 412.56400000000014 , 151.0154400000001 ] , [ 414.1510000000001 , 154.49513000000007 ] , [ 415.6 , 158.08000000000007 ] , [ 416.9110000000001 , 161.7656700000001 ] , [ 418.08400000000006 , 165.5477600000001 ] , [ 419.119 , 169.4218900000001 ] , [ 420.0160000000001 , 173.38368000000008 ] , [ 420.77500000000015 , 177.4287500000001 ] , [ 421.3960000000001 , 181.55272000000014 ] , [ 421.8790000000001 , 185.75121000000013 ] , [ 422.22400000000005 , 190.01984000000013 ] , [ 422.43100000000004 , 194.35423000000014 ] , [ 422.50000000000006 , 198.75000000000009 ] , [ 422.43100000000004 , 203.20277000000013 ] , [ 422.224 , 207.70816000000013 ] , [ 421.87899999999996 , 212.26179000000008 ] , [ 421.396 , 216.85928000000013 ] , [ 420.7749999999999 , 221.4962500000001 ] , [ 420.01599999999996 , 226.16832000000014 ] , [ 419.1189999999999 , 230.87111000000016 ] , [ 418.084 , 235.60024000000016 ] , [ 416.91099999999994 , 240.35133000000013 ] , [ 415.6 , 245.12000000000018 ] , [ 414.15099999999995 , 249.90187000000014 ] , [ 412.56399999999996 , 254.69256000000013 ] , [ 410.83899999999994 , 259.48769000000016 ] , [ 408.97599999999994 , 264.2828800000002 ] , [ 406.9749999999999 , 269.0737500000002 ] , [ 404.83599999999996 , 273.8559200000002 ] , [ 402.55899999999997 , 278.6250100000002 ] , [ 400.1439999999999 , 283.3766400000002 ] , [ 397.5909999999999 , 288.10643000000016 ] , [ 394.89999999999986 , 292.8100000000002 ] , [ 392.07099999999986 , 297.48297000000014 ] , [ 389.10399999999987 , 302.1209600000002 ] , [ 385.9989999999999 , 306.71959000000015 ] , [ 382.75599999999986 , 311.2744800000002 ] , [ 379.3749999999999 , 315.7812500000002 ] , [ 375.8559999999998 , 320.2355200000002 ] , [ 372.19899999999984 , 324.6329100000002 ] , [ 368.4039999999998 , 328.9690400000002 ] , [ 364.4709999999998 , 333.2395300000002 ] , [ 360.3999999999998 , 337.44000000000017 ] , [ 356.1909999999998 , 341.5660700000002 ] , [ 351.8439999999997 , 345.61336000000017 ] , [ 347.35899999999975 , 349.57749000000024 ] , [ 342.73599999999976 , 353.4540800000002 ] , [ 337.97499999999974 , 357.2387500000002 ] , [ 333.07599999999974 , 360.9271200000002 ] , [ 328.03899999999965 , 364.5148100000001 ] , [ 322.8639999999997 , 367.99744000000015 ] , [ 317.5509999999997 , 371.3706300000002 ] , [ 312.0999999999997 , 374.6300000000002 ] , [ 306.5109999999996 , 377.7711700000002 ] , [ 300.78399999999965 , 380.7897600000002 ] , [ 294.91899999999964 , 383.68139000000014 ] , [ 288.91599999999966 , 386.4416800000002 ] , [ 282.77499999999964 , 389.06625000000014 ] , [ 276.4959999999996 , 391.5507200000002 ] , [ 270.0789999999996 , 393.8907100000002 ] , [ 263.52399999999955 , 396.0818400000001 ] , [ 256.83099999999956 , 398.1197300000001 ] , [ 250 , 400 ] , [ 243.16899999999998 , 398.11973 ] , [ 236.47599999999997 , 396.08183999999994 ] , [ 229.92100000000002 , 393.89070999999996 ] , [ 223.504 , 391.55072 ] , [ 217.225 , 389.0662499999999 ] , [ 211.08399999999995 , 386.44167999999996 ] , [ 205.08099999999993 , 383.6813899999999 ] , [ 199.21600000000004 , 380.78976000000006 ] , [ 193.48900000000006 , 377.7711700000001 ] , [ 187.9 , 374.63 ] , [ 182.449 , 371.37062999999995 ] , [ 177.136 , 367.99744 ] , [ 171.961 , 364.51480999999995 ] , [ 166.92399999999998 , 360.92711999999995 ] , [ 162.02499999999998 , 357.23875000000004 ] , [ 157.264 , 353.45408 ] , [ 152.641 , 349.57748999999995 ] , [ 148.15599999999995 , 345.61335999999994 ] , [ 143.80899999999994 , 341.5660699999999 ] , [ 139.59999999999997 , 337.43999999999994 ] , [ 135.52899999999994 , 333.2395299999999 ] , [ 131.59599999999995 , 328.96903999999995 ] , [ 127.80099999999997 , 324.63291 ] , [ 124.14399999999998 , 320.23552 ] , [ 120.625 , 315.78125 ] , [ 117.244 , 311.27448000000004 ] , [ 114.00099999999999 , 306.71959000000004 ] , [ 110.896 , 302.12096 ] , [ 107.929 , 297.4829700000001 ] , [ 105.1 , 292.81 ] , [ 102.40900000000002 , 288.10643 ] , [ 99.856 , 283.37664 ] , [ 97.441 , 278.62501000000003 ] , [ 95.16399999999997 , 273.85591999999997 ] , [ 93.02499999999999 , 269.07375 ] , [ 91.02399999999999 , 264.2828799999999 ] , [ 89.16099999999999 , 259.48769 ] , [ 87.43599999999998 , 254.69256000000001 ] , [ 85.84899999999999 , 249.90187 ] , [ 84.39999999999998 , 245.11999999999992 ] , [ 83.089 , 240.35132999999996 ] , [ 81.916 , 235.60023999999993 ] , [ 80.881 , 230.87110999999993 ] , [ 79.984 , 226.16831999999994 ] , [ 79.225 , 221.49624999999995 ] , [ 78.604 , 216.85927999999993 ] , [ 78.12100000000001 , 212.26178999999996 ] , [ 77.77600000000001 , 207.70815999999996 ] , [ 77.569 , 203.2027699999999 ] , [ 77.5 , 198.74999999999991 ] , [ 77.569 , 194.35422999999992 ] , [ 77.77600000000001 , 190.0198399999999 ] , [ 78.12100000000001 , 185.75120999999987 ] , [ 78.60400000000001 , 181.55271999999988 ] , [ 79.22500000000002 , 177.42874999999987 ] , [ 79.98400000000002 , 173.38367999999988 ] , [ 80.88100000000003 , 169.4218899999999 ] , [ 81.91600000000004 , 165.5477599999999 ] , [ 83.08900000000003 , 161.7656699999999 ] , [ 84.40000000000003 , 158.0799999999999 ] , [ 85.84900000000005 , 154.49512999999988 ] , [ 87.43600000000005 , 151.01543999999987 ] , [ 89.16100000000006 , 147.64530999999988 ] , [ 91.02400000000007 , 144.3891199999999 ] , [ 93.02500000000008 , 141.25124999999989 ] , [ 95.16400000000009 , 138.2360799999999 ] , [ 97.44100000000009 , 135.3479899999999 ] , [ 99.8560000000001 , 132.5913599999999 ] , [ 102.40900000000009 , 129.9705699999999 ] , [ 105.10000000000011 , 127.4899999999999 ] , [ 107.9290000000001 , 125.1540299999999 ] , [ 110.89600000000013 , 122.96703999999991 ] , [ 114.00100000000013 , 120.93340999999992 ] , [ 117.24400000000013 , 119.05751999999991 ] , [ 120.62500000000017 , 117.34374999999993 ] , [ 124.14400000000015 , 115.79647999999993 ] , [ 127.80100000000019 , 114.42008999999995 ] , [ 131.59600000000017 , 113.21895999999994 ] , [ 135.5290000000002 , 112.19746999999995 ] , [ 139.6000000000002 , 111.35999999999996 ] , [ 143.8090000000002 , 110.71092999999996 ] , [ 148.1560000000002 , 110.25463999999998 ] , [ 152.64100000000025 , 109.99550999999998 ] , [ 157.26400000000024 , 109.93792 ] , [ 162.02500000000026 , 110.08625 ] , [ 166.92400000000026 , 110.44488000000001 ] , [ 171.96100000000027 , 111.01819000000002 ] , [ 177.1360000000003 , 111.81056000000005 ] , [ 182.44900000000032 , 112.82637000000008 ] , [ 187.90000000000035 , 114.07000000000008 ] , [ 193.48900000000032 , 115.54583000000008 ] , [ 199.21600000000032 , 117.2582400000001 ] , [ 205.08100000000036 , 119.21161000000012 ] , [ 211.08400000000037 , 121.41032000000016 ] , [ 217.2250000000004 , 123.85875000000016 ] , [ 223.5040000000004 , 126.56128000000018 ] , [ 229.92100000000042 , 129.5222900000002 ] , [ 236.47600000000043 , 132.7461600000002 ] , [ 243.16900000000044 , 136.23727000000025 ] ];

        var left = [ [ 250 , 400 ] , [ 229.92100000000002 , 393.89070999999996 ] , [ 211.08399999999995 , 386.44167999999996 ] , [ 193.48900000000006 , 377.7711700000001 ] , [ 177.136 , 367.99744 ] , [ 162.02499999999998 , 357.23875000000004 ] , [ 148.15599999999995 , 345.61335999999994 ] , [ 135.52899999999994 , 333.2395299999999 ] , [ 124.14399999999998 , 320.23552 ] , [ 114.00099999999999 , 306.71959000000004 ] , [ 105.1 , 292.81 ] , [ 97.441 , 278.62501000000003 ] , [ 91.02399999999999 , 264.2828799999999 ] , [ 85.84899999999999 , 249.90187 ] , [ 81.916 , 235.60023999999993 ] , [ 79.225 , 221.49624999999995 ] , [ 77.77600000000001 , 207.70815999999996 ] , [ 77.569 , 194.35422999999992 ] , [ 78.60400000000001 , 181.55271999999988 ] , [ 80.88100000000003 , 169.4218899999999 ] , [ 84.40000000000003 , 158.0799999999999 ] , [ 89.16100000000006 , 147.64530999999988 ] , [ 95.16400000000009 , 138.2360799999999 ] , [ 102.40900000000009 , 129.9705699999999 ] , [ 110.89600000000013 , 122.96703999999991 ] , [ 120.62500000000017 , 117.34374999999993 ] , [ 131.59600000000017 , 113.21895999999994 ] , [ 143.8090000000002 , 110.71092999999996 ] , [ 157.26400000000024 , 109.93792 ] , [ 171.96100000000027 , 111.01819000000002 ] , [ 187.90000000000035 , 114.07000000000008 ] , [ 205.08100000000036 , 119.21161000000012 ] , [ 223.5040000000004 , 126.56128000000018 ] , [ 243.16900000000044 , 136.23727000000025 ] , [ 243.16900000000044 , 136.23727000000025 ] ];
        var right = [ [ 256.83099999999956 , 398.1197300000001 ] , [ 276.4959999999996 , 391.5507200000002 ] , [ 294.91899999999964 , 383.68139000000014 ] , [ 312.0999999999997 , 374.6300000000002 ] , [ 328.03899999999965 , 364.5148100000001 ] , [ 342.73599999999976 , 353.4540800000002 ] , [ 356.1909999999998 , 341.5660700000002 ] , [ 368.4039999999998 , 328.9690400000002 ] , [ 379.3749999999999 , 315.7812500000002 ] , [ 389.10399999999987 , 302.1209600000002 ] , [ 397.5909999999999 , 288.10643000000016 ] , [ 404.83599999999996 , 273.8559200000002 ] , [ 410.83899999999994 , 259.48769000000016 ] , [ 415.6 , 245.12000000000018 ] , [ 419.1189999999999 , 230.87111000000016 ] , [ 421.396 , 216.85928000000013 ] , [ 422.43100000000004 , 203.20277000000013 ] , [ 422.22400000000005 , 190.01984000000013 ] , [ 420.77500000000015 , 177.4287500000001 ] , [ 418.08400000000006 , 165.5477600000001 ] , [ 414.1510000000001 , 154.49513000000007 ] , [ 408.97600000000006 , 144.38912000000005 ] , [ 402.55900000000014 , 135.34799000000007 ] , [ 394.90000000000015 , 127.49000000000005 ] , [ 385.9990000000001 , 120.93341000000002 ] , [ 375.856 , 115.79648 ] , [ 364.47099999999995 , 112.19747 ] , [ 351.844 , 110.25464 ] , [ 337.97499999999997 , 110.08624999999998 ] , [ 322.864 , 111.81055999999998 ] , [ 306.511 , 115.54583000000001 ] , [ 288.9159999999999 , 121.41031999999997 ] , [ 270.079 , 129.52228999999997 ] , [ 250 , 140 ] , [ 250 , 140 ] ];

        var index = 0 , len = left.length;

        var angle = Math.PI / 180;
        var img = new Image();
        img.src = "img/heart.png";

        function setHeart( x , y , rotate , opacity , size ) {
            gl.save();
            gl.translate( x , y );
            gl.rotate( angle * rotate );
            gl.globalAlpha = opacity;
            gl.drawImage( img , 0 , 0 , size || 20 , size || 20 );
            gl.restore();
        }

        var hearts = [];

        function makeHeart( x0 , y0 ) {
            var x = x0 + (Math.random() - 0.5) * 40 ,
                    y = y0 + (Math.random() - 0.5) * 40 ,
                    rotate = 90 * Math.random() ,
                    opacity = 1;
            setHeart( x , y , rotate , opacity );
//            var dx = x - 250 , dy = y - 250;
//            var sum = Math.abs( dx ) + Math.abs( dy );
//            var vx = 2 * dx / sum , vy = 2 * dy / sum;
            var vx = (Math.random() - 0.5) * 4 , vy = (Math.random() - 0.5) * 4;
            hearts.push( {
                x : x , y : y , rotate : rotate , opacity : opacity , vx : vx , vy : vy
            } )
        }

        img.onload = function () {
            if ( index < len ) {
                makeHeart( left[ index ][ 0 ] , left[ index ][ 1 ] );
                makeHeart( left[ index ][ 0 ] , left[ index ][ 1 ] );
                makeHeart( right[ index ][ 0 ] , right[ index ][ 1 ] );
                makeHeart( right[ index ][ 0 ] , right[ index ][ 1 ] );
                index ++;
                setTimeout( arguments.callee , 20 );
            }
            else {
                // 开始散开的设计
                console.log( hearts.length );
                (function () {
                    var live = hearts.length;
                    gl.clearRect( 0 , 0 , 500 , 500 );
                    for ( var i = 0; i < hearts.length; i ++ ) {
                        hearts[ i ].opacity -= 0.02;
                        if ( hearts[ i ].opacity >= 0 ) {
                            hearts[ i ].x += hearts[ i ].vx;
                            hearts[ i ].y += hearts[ i ].vy;
                            setHeart( hearts[ i ].x , hearts[ i ].y , hearts[ i ].rotate , hearts[ i ].opacity );
                        } else {
                            live --;
                        }
                    }
                    if ( live ) {
                        setTimeout( arguments.callee , 20 );
                    } else {
                        console.log( "end" );
                    }
                })()

            }
        }


    })();
</script>
</body>
</html>