<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="mobileoptimized" content="0"/>
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="screen-orientation" content="portrait">
    <meta name="browsermode" content="application">
    <title>调试动画组</title>

    <style>
        body {
            font-family: "微软雅黑", sans-serif;
        }
    </style>

    <script src="../../lib/zach/client.js"></script>
    <script>
        main( function () {
            var debug = imports( "../debug" );
            var object = imports( "object" );
            var async = imports( "async" );
            var parent = window.parent;

            var pageList = {}, enterAnimationList = {};

            debug.loadFirstPage( {
                type : "local"
            }, function () {
                async.concurrency( [
                    function ( done ) {
                        debug.loadData( {
                            dir : "animation-lab/pages",
                            doOut : function ( data ) {
                                object.foreach( data, function ( name, data ) {
                                    pageList[name] = data;
                                } );
                            }
                        }, done );
                    },
                    function ( done ) {
                        debug.loadData( {
                            dir : "enter-animation-list",
                            doOut : function ( data ) {
                                object.foreach( data, function ( name, data ) {
                                    enterAnimationList[name] = data;
                                } );
                            }
                        }, done );
                    }
                ], function () {
                    parent.onPhoneLoad && parent.onPhoneLoad( {
                        enterAnimationList : enterAnimationList,
                        pageList : pageList,
                        run : function ( arg ) {
                            var animationGroup = arg.animationGroup;
                            var pageData = arg.pageData;
                            var format = layoutFormats[pageData.label];
                            var oldComponent = layoutFormats.components;

                            layoutFormats.test = object.extend( format, {
                                create : function ( layout ) {
                                    format.create.apply( null, arguments );
                                    animationGroup( layout );
                                }
                            } );

                            layoutFormats.components = object.extend( format, {
                                create : function ( layout ) {
                                    oldComponent.create.apply( null, arguments );
                                    animationGroup( layout );
                                }
                            } );

                            fp.loadWork = function ( callback ) {
                                callback( {
                                    pages : [object.extend( pageData, {
                                        label : "test"
                                    } )]
                                } );
                            };

                            runFirstPage();
                        }
                    } );
                } );
            } );
        } );
    </script>
</head>
<body>
</body>
</html>