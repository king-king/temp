<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title></title>
</head>
<body>
<script>
    (function () {

        var canvas = document.createElement( "canvas" );
        var gc = canvas.getContext( "2d" );
        var w = h = 400;
        canvas.width = canvas.height = h;

        var img = new Image();
        img.src = "img/6.jpg";
        img.onload = function () {
            gc.drawImage( img, 0, 0, w, h );
            var imgdata = gc.getImageData( 100, 200, 200, 200 );
            console.log( imgdata.data[8], imgdata.data[9], imgdata.data[10] );
            gc.drawImage( filter( imgdata, 200, 200 ), 100, 200 );
            document.body.appendChild( canvas );
        };


        function filter( imgdata, w, h ) {
            var rq = [], gq = [], bq = [], rsum = 0, gsum = 0, bsum = 0;
            var r = -1;
            var len;
            var index;
            var data = imgdata.data;
            for ( var y = 0; y < h; y++ ) {
                for ( var x = 0; x < w; x++ ) {
                    if ( x == 0 ) {
                        r = -1;
                    }
                    x % 4 == 0 && r++;
                    index = (y * w + x) * 4;
                    if ( rq.length > r ) {
                        rsum = rsum - rq.shift();
                        gsum = gsum - gq.shift();
                        bsum = bsum - bq.shift();
                    }
                    rsum += data[index];
                    rq.push( data[index] );
                    gsum += data[index + 1];
                    gq.push( data[index + 1] );
                    bsum += data[index + 2];
                    bq.push( data[index + 2] );
                    len = rq.length;
                    data[index] = rsum / len << 0;
                    data[index + 1] = gsum / len << 0;
                    data[index + 2] = bsum / len << 0;
                }
            }


            var ca = document.createElement( "canvas" );
            var gc2 = ca.getContext( "2d" );
            ca.width = ca.height = 200;
            imgdata.data = data;
            gc2.putImageData( imgdata, 0, 0 );
            gc2.globalCompositeOperation = "destination-out";

            var Gradient;
            for ( var m = 0; m <= 200; m += 40 ) {
                gc2.beginPath();
                Gradient = gc2.createRadialGradient( m, 0, 0, m, 0, 50 );
                Gradient.addColorStop( 0, 'rgba(0,0,0,1)' );
                Gradient.addColorStop( 1, 'rgba(255, 255, 255, 0)' );
                gc2.fillStyle = Gradient;
                gc2.arc( m, 0, 50, 0, Math.PI * 2, true );
                gc2.fill();

                gc2.beginPath();
                Gradient = gc2.createRadialGradient( m, 200, 0, m, 200, 50 );
                Gradient.addColorStop( 0, 'rgba(0,0,0,1)' );
                Gradient.addColorStop( 1, 'rgba(255, 255, 255, 0)' );
                gc2.fillStyle = Gradient;
                gc2.arc( m, 200, 50, 0, Math.PI * 2, true );
                gc2.fill();

                gc2.beginPath();
                Gradient = gc2.createRadialGradient( 200, m, 0, 200, m, 50 );
                Gradient.addColorStop( 0, 'rgba(0,0,0,1)' );
                Gradient.addColorStop( 1, 'rgba(255, 255, 255, 0)' );
                gc2.fillStyle = Gradient;
                gc2.arc( 200, m, 50, 0, Math.PI * 2, true );
                gc2.fill();

                gc2.beginPath();
                Gradient = gc2.createRadialGradient( 0, m, 0, 0, m, 50 );
                Gradient.addColorStop( 0, 'rgba(0,0,0,1)' );
                Gradient.addColorStop( 1, 'rgba(255, 255, 255, 0)' );
                gc2.fillStyle = Gradient;
                gc2.arc( 0, m, 50, 0, Math.PI * 2, true );
                gc2.fill();
            }

            return ca;

        }

    })();
</script>
</body>
</html>